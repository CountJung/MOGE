@using MudBlazor
@using SharedUI.Services

<MudDialog>
    <DialogContent>
        <MudStack Spacing="2">
            <MudTextField @bind-Value="_fileName" Label="파일 이름" Variant="Variant.Outlined" dense="true" />

            <MudSelect T="ImageExportFormat" Label="파일 포맷" Variant="Variant.Outlined" dense="true" @bind-Value="_format">
                <MudSelectItem Value="ImageExportFormat.Png">PNG (.png)</MudSelectItem>
                <MudSelectItem Value="ImageExportFormat.Jpeg">JPEG (.jpg)</MudSelectItem>
            </MudSelect>
        </MudStack>
    </DialogContent>

    <DialogActions>
        <MudButton OnClick="Cancel">취소</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" Disabled="@string.IsNullOrWhiteSpace(_fileName)" OnClick="Save">저장</MudButton>
    </DialogActions>
</MudDialog>

@code {
    public sealed record Result(string FileName, ImageExportFormat Format);

    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter] public string? InitialFileName { get; set; }
    [Parameter] public ImageExportFormat InitialFormat { get; set; } = ImageExportFormat.Png;

    private string _fileName = string.Empty;
    private ImageExportFormat _format;

    protected override void OnInitialized()
    {
        _fileName = string.IsNullOrWhiteSpace(InitialFileName) ? "image" : InitialFileName;
        _format = InitialFormat;
    }

    private void Cancel() => MudDialog.Cancel();

    private void Save()
    {
        var name = FileNameUtil.SanitizeFileName(_fileName, "image");
        MudDialog.Close(DialogResult.Ok(new Result(name, _format)));
    }
}
